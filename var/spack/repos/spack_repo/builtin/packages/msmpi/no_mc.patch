# Patch partially based on: https://github.com/microsoft/vcpkg/pull/13218
diff --git a/src/launchSvc/msmpiLaunchSvcMc.vcxproj b/src/launchSvc/msmpiLaunchSvcMc.vcxproj
index 2a6952b..b9a9eba 100644
--- a/src/launchSvc/msmpiLaunchSvcMc.vcxproj
+++ b/src/launchSvc/msmpiLaunchSvcMc.vcxproj
@@ -15,12 +15,10 @@
   </PropertyGroup>
   <Import Project="$(VCTargetsPath)\Microsoft.Cpp.props" />
   <ItemGroup>
-    <MessageCompile Include="launchsvcmsg.mc">
-      <GeneratedHeaderPath>true</GeneratedHeaderPath>
-      <HeaderFilePath>$(SrcRoot)\launchsvc\$(O)</HeaderFilePath>
-      <GeneratedRCAndMessagesPath>true</GeneratedRCAndMessagesPath>
-      <RCFilePath>$(SrcRoot)\launchsvc\$(O)</RCFilePath>
-    </MessageCompile>
+    <CustomBuild Include="$(SrcRoot)\launchSvc\launchSvcMsg.mc">
+      <Command>mc.exe -um -h $(SrcRoot)\launchSvc\$(O) -r $(SrcRoot)\launchSvc\$(O) $(SrcRoot)\launchSvc\launchSvcMsg.mc</Command>
+      <Outputs>$(SrcRoot)\launchSvc\$(O)\launchSvcMsg.h;$(SrcRoot)\launchSvc\$(O)\launchSvcMsg.rc</Outputs>
+   </CustomBuild>
   </ItemGroup>
   <Import Project="$(VCTargetsPath)\Microsoft.Cpp.targets" />
 </Project>
\ No newline at end of file
diff --git a/src/mpi/common/traceManifest.vcxproj b/src/mpi/common/traceManifest.vcxproj
index f80e80b..eb9281d 100644
--- a/src/mpi/common/traceManifest.vcxproj
+++ b/src/mpi/common/traceManifest.vcxproj
@@ -15,16 +15,10 @@
   <Import Project="$(VCTargetsPath)\Microsoft.Cpp.props" />
 
   <ItemGroup>
-    <MessageCompile Include="$(MPI_SRC_ROOT)\common\mpitrace.man">
-      <GeneratedHeaderPath>true</GeneratedHeaderPath>
-      <HeaderFilePath>$(MPI_SRC_ROOT)\common\$(O)</HeaderFilePath>
-      <GeneratedRCAndMessagesPath>true</GeneratedRCAndMessagesPath>
-      <RCFilePath>$(MPI_SRC_ROOT)\common\$(O)</RCFilePath>
-      <GeneratedFilesBaseName>MpiTraceEvents</GeneratedFilesBaseName>
-      <GenerateUserModeLoggingMacros>true</GenerateUserModeLoggingMacros>
-      <PrefixMacroName>Trace</PrefixMacroName>
-      <RemoveCharsFromSymbolName>EVENT_</RemoveCharsFromSymbolName>
-    </MessageCompile>
+    <CustomBuild Include="$(MPI_SRC_ROOT)\common\mpitrace.man">
+      <Command>mc.exe -um -p Trace -P EVENT_ -h $(MPI_SRC_ROOT)\common\$(O) -r $(MPI_SRC_ROOT)\common\$(O) -z MpiTraceEvents $(MPI_SRC_ROOT)\common\mpitrace.man</Command>
+      <Outputs>$(MPI_SRC_ROOT)\common\$(O)\MpiTraceEvents.h;$(MPI_SRC_ROOT)\common\$(O)\MpiTraceEvents.rc</Outputs>
+   </CustomBuild>
   </ItemGroup>
   <Import Project="$(VCTargetsPath)\Microsoft.Cpp.targets" />
 </Project>
\ No newline at end of file
